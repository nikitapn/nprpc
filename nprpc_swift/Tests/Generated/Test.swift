// Generated by npidl compiler
// DO NOT EDIT - all changes will be lost

import NPRPC

public enum Color: Int {
  case red
  case green
  case blue
}

public struct Point: Codable, Sendable {
  public var x: Int32
  public var y: Int32

  public init(x: Int32, y: Int32)   {
    self.x = x
    self.y = y
  }
}


// MARK: - Marshal Point

func marshal_Point(buffer: UnsafeMutableRawPointer, offset: Int, data: Point) {
  buffer.storeBytes(of: data.x, toByteOffset: offset + 0, as: Int32.self)
  buffer.storeBytes(of: data.y, toByteOffset: offset + 4, as: Int32.self)
}

// MARK: - Unmarshal Point

func unmarshal_Point(buffer: UnsafeRawPointer, offset: Int) -> Point {
  return Point(
    x: buffer.load(fromByteOffset: offset + 0, as: Int32.self),
    y: buffer.load(fromByteOffset: offset + 4, as: Int32.self)
  )
}
public struct Rectangle: Codable, Sendable {
  public var topLeft: Point
  public var bottomRight: Point
  public var color: Color

  public init(topLeft: Point, bottomRight: Point, color: Color)   {
    self.topLeft = topLeft
    self.bottomRight = bottomRight
    self.color = color
  }
}


// MARK: - Marshal Rectangle

func marshal_Rectangle(buffer: UnsafeMutableRawPointer, offset: Int, data: Rectangle) {
  marshal_Point(buffer: buffer, offset: offset + 0, data: data.topLeft)
  marshal_Point(buffer: buffer, offset: offset + 8, data: data.bottomRight)
  buffer.storeBytes(of: data.color.rawValue, toByteOffset: offset + 16, as: Int32.self)
}

// MARK: - Unmarshal Rectangle

func unmarshal_Rectangle(buffer: UnsafeRawPointer, offset: Int) -> Rectangle {
  return Rectangle(
    topLeft: unmarshal_Point(buffer: buffer, offset: offset + 0),
    bottomRight: unmarshal_Point(buffer: buffer, offset: offset + 8),
    color: Color(rawValue: buffer.load(fromByteOffset: offset + 16, as: Int32.self))!
  )
}
public protocol CalculatorProtocol {
  func add(a: Int32, b: Int32) throws -> Int32
  func divide(numerator: Double, denominator: Double) throws -> Double
}

// Client proxy for Calculator
// Wraps C++ proxy and provides Swift-friendly API
public class Calculator: CalculatorProtocol {
  private var cppProxy: Test.Calculator

  public init(_ cppProxy: Test.Calculator)   {
    self.cppProxy = cppProxy
  }

  public static func create(from object: nprpc.Object) -> Calculator   {
    return Calculator(Test.Calculator(object))
  }

  public func add(a: Int32, b: Int32) throws -> Int32   {
    // Call C++ proxy (handles marshalling)
    var result: Int32 = 0
    cppProxy.add(a, b, &result)
    return result
  }

  public func divide(numerator: Double, denominator: Double) throws -> Double   {
    // Call C++ proxy (handles marshalling)
    var result: Double = 0
    cppProxy.divide(numerator, denominator, &result)
    return result
  }

}

// Servant base for Calculator
// Subclass and implement methods. C++ bridge handles dispatch.
open class CalculatorServant: CalculatorProtocol {
  public init() {}

  open func add(a: Int32, b: Int32) throws -> Int32   {
    fatalError("Subclass must implement add")
  }

  open func divide(numerator: Double, denominator: Double) throws -> Double   {
    fatalError("Subclass must implement divide")
  }

}


// MARK: - C Trampolines for Swift Servant
// These are called from C++ bridge (Calculator_SwiftBridge)

@_cdecl("add_swift_trampoline")
func add_swift_trampoline(
  _ servant: UnsafeMutableRawPointer,
  _ a: Int32,
  _ b: Int32,
  _ result: UnsafeMutablePointer<Int32>
) {
  let swiftServant = Unmanaged<CalculatorServant>.fromOpaque(servant).takeUnretainedValue()
  do   {
    let resultValue = try swiftServant.add(a: a, b: b)
    result.pointee = resultValue
  }
 catch   {
    // TODO: Propagate Swift error to C++ exception
    fatalError("Error in add: \(error)")
  }
}


@_cdecl("divide_swift_trampoline")
func divide_swift_trampoline(
  _ servant: UnsafeMutableRawPointer,
  _ numerator: Double,
  _ denominator: Double,
  _ result: UnsafeMutablePointer<Double>
) {
  let swiftServant = Unmanaged<CalculatorServant>.fromOpaque(servant).takeUnretainedValue()
  do   {
    let resultValue = try swiftServant.divide(numerator: numerator, denominator: denominator)
    result.pointee = resultValue
  }
 catch   {
    // TODO: Propagate Swift error to C++ exception
    fatalError("Error in divide: \(error)")
  }
}


public protocol ShapeServiceProtocol {
  func getRectangle(id: UInt32) throws -> Rectangle
  func setRectangle(id: UInt32, rect: Rectangle) throws
}

// Client proxy for ShapeService
// Wraps C++ proxy and provides Swift-friendly API
public class ShapeService: ShapeServiceProtocol {
  private var cppProxy: Test.ShapeService

  public init(_ cppProxy: Test.ShapeService)   {
    self.cppProxy = cppProxy
  }

  public static func create(from object: nprpc.Object) -> ShapeService   {
    return ShapeService(Test.ShapeService(object))
  }

  public func getRectangle(id: UInt32) throws -> Rectangle   {
    // Call C++ proxy (handles marshalling)
    var rect: Rectangle = 0
    cppProxy.getRectangle(id, &rect)
    return rect
  }

  public func setRectangle(id: UInt32, rect: Rectangle) throws   {
    // Call C++ proxy (handles marshalling)
    cppProxy.setRectangle(id, rect)
  }

}

// Servant base for ShapeService
// Subclass and implement methods. C++ bridge handles dispatch.
open class ShapeServiceServant: ShapeServiceProtocol {
  public init() {}

  open func getRectangle(id: UInt32) throws -> Rectangle   {
    fatalError("Subclass must implement getRectangle")
  }

  open func setRectangle(id: UInt32, rect: Rectangle) throws   {
    fatalError("Subclass must implement setRectangle")
  }

}


// MARK: - C Trampolines for Swift Servant
// These are called from C++ bridge (ShapeService_SwiftBridge)

@_cdecl("getRectangle_swift_trampoline")
func getRectangle_swift_trampoline(
  _ servant: UnsafeMutableRawPointer,
  _ id: UInt32,
  _ rect: UnsafeMutableRawPointer
) {
  let swiftServant = Unmanaged<ShapeServiceServant>.fromOpaque(servant).takeUnretainedValue()
  do   {
    let rectValue = try swiftServant.getRectangle(id: id)
    marshal_Rectangle(buffer: rect, offset: 0, data: rectValue)
  }
 catch   {
    // TODO: Propagate Swift error to C++ exception
    fatalError("Error in getRectangle: \(error)")
  }
}


@_cdecl("setRectangle_swift_trampoline")
func setRectangle_swift_trampoline(
  _ servant: UnsafeMutableRawPointer,
  _ id: UInt32,
  _ rect: UnsafeRawPointer
) {
  let swiftServant = Unmanaged<ShapeServiceServant>.fromOpaque(servant).takeUnretainedValue()
  let rectUnmarshaled = unmarshal_Rectangle(buffer: rect, offset: 0)
  do   {
    try swiftServant.setRectangle(id: id, rect: rectUnmarshaled)
  }
 catch   {
    // TODO: Propagate Swift error to C++ exception
    fatalError("Error in setRectangle: \(error)")
  }
}


